<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LAAT25 Nisäkäsharjoitus</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
      background-color: #2c2c2c;
      color: white;
    }
    img {
      width: 500px;
      height: auto;
      border: 2px solid #000;
      margin-bottom: 20px;
      cursor: pointer;
    }
    button {
      margin: 10px;
      padding: 10px;
      font-size: 25px;
      background-color: #444;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #555;
    }
    #score {
      font-size: 20px;
      margin-top: 15px;
    }
    #options {
      display: none;
    }
    #answerInput {
      margin-top: 20px;
      font-size: 20px;
      padding: 8px;
      width: 60%;
      background-color: #444;
      color: white;
      border: 1px solid #666;
    }
    #answerInstruction {
      font-size: 18px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>LAAT25 Nisäkäsharjoitus</h1>
  <div id="quiz">
    <img id="birdImage" src="" alt="Eläimen kuva" onclick="showOptions()">
    <div id="options">
      <button onclick="checkAnswer(0)"></button>
      <button onclick="checkAnswer(1)"></button>
      <button onclick="checkAnswer(2)"></button>
    </div>
    <p id="result"></p>
    <p id="score"></p>
    <p id="answerInstruction">Klikkaamalla kuvaa saat vaihtoehdot, tai voit kirjoittaa eläimen nimen suoraan tähän:</p>
    <input type="text" id="answerInput" placeholder="Kirjoita eläimen nimi ja paina Enter">
  </div>

  <script>
    const mammalsByCategory = {
      "Pedot": ["ahma", "hilleri", "ilves", "karhu", "kärppä", "lumikko", "minkki", "mäyrä", "näätä", "susi"],
      "Jyrsijät": ["kotihiiri", "majava", "metsämyyrä", "peltomyyrä", "piisami", "rotta", "vesimyyrä"],
      "Pienet nisäkkäät": ["metsäpäästäinen", "siili", "tunturisopuli", "pohjanlepakko"],
      "Kanit ja jänikset": ["jänis", "rusakko"],
      "Koiraeläimet": ["kettu", "naali", "supikoira"],
      "Kissat": ["ilves"],
      "Hirvieläimet": ["hirvi", "metsäpeura", "poro", "valkohäntäpeura"],
      "Oravat ja sukulaiset": ["orava", "liito-orava"],
      "Vesinisäkkäät": ["saukko", "norppa", "hylje"]
    };

    const animalNameMappings = {
      "ahma": "Gulo gulo",
      "hilleri": "Mustela putorius",
      "hirvi": "Alces alces",
      "hylje": "Phoca vitulina",
      "ilves": "Lynx lynx",
      "karhu": "Ursus arctos",
      "jänis": "Lepus timidus",
      "kettu": "Vulpes vulpes",
      "kotihiiri": "Mus musculus",
      "kärppä": "Mustela erminea",
      "liito-orava": "Pteromys volans",
      "lumikko": "Mustela nivalis",
      "majava": "Castor fiber",
      "metsäpäästäinen": "Sorex araneus",
      "peltomyyrä": "Microtus agrestis",
      "metsämyyrä": "Myodes glareolus",
      "metsäpeura": "Rangifer tarandus fennicus",
      "minkki": "Neovison vison",
      "mäyrä": "Meles meles",
      "naali": "Vulpes lagopus",
      "norppa": "Pusa hispida",
      "näätä": "Martes martes",
      "orava": "Sciurus vulgaris",
      "piisami": "Ondatra zibethicus",
      "pohjanlepakko": "Eptesicus nilssonii",
      "poro": "Rangifer tarandus",
      "rotta": "Rattus norvegicus",
      "rusakko": "Lepus europaeus",
      "saukko": "Lutra lutra",
      "siili": "Erinaceus europaeus",
      "supikoira": "Nyctereutes procyonoides",
      "susi": "Canis lupus",
      "tunturisopuli": "Lemmus lemmus",
      "valkohäntäpeura": "Odocoileus virginianus",
      "vesimyyrä": "Arvicola amphibius"
    };

    const allMammals = Object.values(mammalsByCategory).flat();
    let shuffledMammals = [];
    let currentAnimal;
    let currentCategoryAnimals = [];
    let correctAnswerIndex;
    let questionIndex = 0;
    let correctCount = 0;
    let totalPoints = 0;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function getCategory(animalName) {
      for (const [category, animals] of Object.entries(mammalsByCategory)) {
        if (animals.includes(animalName)) return { category, animals };
      }
      return null;
    }

    function getRandomOptionsFromSameCategory(correctAnimal, categoryAnimals) {
      const options = [correctAnimal];
      while (options.length < 3) {
        const randomAnimal = categoryAnimals[Math.floor(Math.random() * categoryAnimals.length)];
        if (!options.includes(randomAnimal)) {
          options.push(randomAnimal);
        }
      }
      return shuffle(options);
    }

    async function fetchWikimediaImage(name) {
      const searchTerm = animalNameMappings[name] || name;
      const url = `https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=pageimages&pithumbsize=500&titles=${encodeURIComponent(searchTerm)}`;
      try {
        const response = await fetch(url);
        const data = await response.json
